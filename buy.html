<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <title>Buy Tickets</title>
  <meta name="viewport" content="width=340, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:linear-gradient(135deg,#0b1020 0%,#121729 50%,#0e1f3f 100%);
      color:#fff;font-family:'Inter',Arial,sans-serif;min-height:100vh;overflow-x:hidden;font-size:14px
    }
    .container{width:340px;margin:0 auto;padding:15px 10px 100px 10px}
    .header{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;padding:12px;text-align:center;margin-bottom:12px;border:1px solid rgba(255,255,255,.1);box-shadow:0 8px 32px rgba(102,126,234,.3)}
    .header-title{font-weight:800;letter-spacing:.5px;font-size:.95em}
    .card{background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px;box-shadow:0 6px 24px rgba(0,0,0,.35);margin-bottom:14px}
    .card h3{font-size:1.05em;font-weight:800;margin-bottom:10px}
    .row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.06)}
    .row:last-child{border-bottom:none}
    .k{color:#aab3c9;font-weight:600}
    .v{font-weight:800;letter-spacing:.3px}
    .accent{color:#4ade80}
    .inline-input{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:8px 10px;margin-top:10px}
    .btn-round{width:32px;height:32px;border-radius:8px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.1);color:#fff;font-weight:900;cursor:pointer}
    .qty{flex:1;text-align:center;font-weight:800;font-size:1em;border:none;outline:none;background:transparent;color:#fff}
    .primary{margin-top:12px;width:100%;background:linear-gradient(135deg,#22c55e,#16a34a);border:none;color:#fff;font-weight:800;padding:10px 12px;border-radius:10px;cursor:pointer;box-shadow:0 6px 16px rgba(34,197,94,.3)}
    .muted{font-size:.85em;color:#b7c0d8;margin-top:6px;text-align:center}
    #snackbar{display:none;position:fixed;top:18px;left:50%;transform:translateX(-50%);background:#059669;color:#fff;padding:12px 24px;border-radius:24px;z-index:2001;font-weight:700;box-shadow:0 4px 16px rgba(5,150,105,.4)}
    #snackbar.error{background:#ef4444}
    .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:340px;background:rgba(0,0,0,.9);backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,.1);border-radius:20px 20px 0 0;padding:16px 8px;display:flex;justify-content:space-around;align-items:center;z-index:100}
    .nav-item{display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:6px 4px;border-radius:10px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);min-width:45px;flex:1;margin:0 2px}
    .nav-icon{width:20px;height:20px;margin-bottom:3px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}
    .nav-home .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'/%3E%3C/svg%3E")}
    .nav-ads .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z'/%3E%3C/svg%3E")}
    .nav-refer .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z'/%3E%3C/svg%3E")}
    .nav-task .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E")}
    .nav-wallet .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z'/%3E%3C/svg%3E")}
    .nav-label{font-size:.65em;font-weight:600;color:#e0e0e0;text-transform:uppercase;letter-spacing:.3px}
    @media (max-width:360px){.container{width:100%;padding:10px 5px 100px 5px}.bottom-nav{width:100%}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header"><div class="header-title" id="header-username">Loading...</div></div>

    <div class="card">
      <h3>Buy tickets</h3>
      <div class="row"><span class="k">Price</span><span class="v">0.005 TON / ticket</span></div>
      <div class="row"><span class="k">Minimum</span><span class="v">10 tickets</span></div>
      <div class="inline-input">
        <button class="btn-round" id="minus">âˆ’</button>
        <input class="qty" id="qty" type="number" min="10" step="1" value="10" />
        <button class="btn-round" id="plus">+</button>
      </div>
      <div class="row"><span class="k">Total TON</span><span class="v accent" id="totalTon">0.050</span></div>
      <button class="primary" id="btn-pay">Pay with Tonkeeper</button>
      <div class="muted">Payment opens Tonkeeper with exact amount.</div>
    </div>
  </div>

  <div id="snackbar"></div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="nav-item nav-home" onclick="location.href='index.html'"><div class="nav-icon"></div><span class="nav-label">Home</span></div>
    <div class="nav-item nav-ads" onclick="location.href='ads.html'"><div class="nav-icon"></div><span class="nav-label">Ads</span></div>
    <div class="nav-item nav-refer" onclick="location.href='refer.html'"><div class="nav-icon"></div><span class="nav-label">Refer</span></div>
    <div class="nav-item nav-task" onclick="location.href='tasks.html'"><div class="nav-icon"></div><span class="nav-label">Tasks</span></div>
    <div class="nav-item nav-wallet" onclick="location.href='wallet.html'"><div class="nav-icon"></div><span class="nav-label">Wallet</span></div>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
  <script type="module">
    // Telegram context
    window.Telegram?.WebApp?.ready?.();
    const tgUser = window.Telegram?.WebApp?.initDataUnsafe?.user;
    const uid = tgUser ? String(tgUser.id) : "UNKNOWN_USER";
    const uname = tgUser?.username ? "@"+tgUser.username : (tgUser ? ("ID:"+tgUser.id) : "UNKNOWN_USER");
    document.getElementById('header-username').textContent = uname;

    // Constants
    const PRICE_TON = 0.005; // per ticket
    const MIN_TICKETS = 10;
    const ADDRESS = "UQB3O8XsvlpniZ-rsanNwLs1THLxYz1Uc5ucrBwlKS3X-dKE";

    // UI refs
    const $ = (id)=>document.getElementById(id);
    const qtyEl = $('qty'), plusEl = $('plus'), minusEl = $('minus');
    const totalTonEl = $('totalTon'), payBtn = $('btn-pay');

    // Snackbar
    function toast(msg, err=false){
      const el=document.getElementById('snackbar'); el.textContent=msg; el.className=err?'error':''; el.style.display='block';
      setTimeout(()=>{ el.style.display='none'; }, err?4000:3000);
    }

    // Helpers
    const toNano = (ton)=> Math.round(ton * 1e9); // integer nanotons
    function refresh(){
      let n = Math.max(MIN_TICKETS, Math.floor(Number(qtyEl.value || MIN_TICKETS)));
      qtyEl.value = String(n);
      const totalTon = n * PRICE_TON;
      totalTonEl.textContent = totalTon.toFixed(3);
    }

    plusEl.onclick = ()=>{ qtyEl.value = String(Math.max(MIN_TICKETS, Math.floor(Number(qtyEl.value||MIN_TICKETS))+1)); refresh(); };
    minusEl.onclick = ()=>{ qtyEl.value = String(Math.max(MIN_TICKETS, Math.floor(Number(qtyEl.value||MIN_TICKETS))-1)); refresh(); };
    qtyEl.oninput = refresh;

    payBtn.onclick = ()=>{
      const n = Math.max(MIN_TICKETS, Math.floor(Number(qtyEl.value||MIN_TICKETS)));
      const totalTon = n * PRICE_TON;
      const amountNano = toNano(totalTon);
      const text = `buy ${n} ticket ${uid}`; // hidden comment, not shown in UI

      // Tonkeeper universal deep-link
      const url = `https://app.tonkeeper.com/transfer/${ADDRESS}?amount=${amountNano}&text=${encodeURIComponent(text)}`;
      window.location.href = url;
    };

    // Init
    refresh();
  </script>
</body>
</html>