<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>Ads - Earn BUMS</title>
  <meta name="viewport" content="width=340, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);color:#fff;font-family:'Inter',Arial,sans-serif;min-height:100vh;overflow-x:hidden;font-size:13px}
    .container{width:340px;margin:0 auto;padding:12px 8px 100px 8px}

    /* Earnings */
    .earnings-box{background:rgba(255,255,255,.05);backdrop-filter:blur(10px);border-radius:14px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,.1);box-shadow:0 8px 32px rgba(0,0,0,.3)}
    .earnings-title{font-size:.95em;font-weight:600;margin-bottom:12px;color:#f0f0f0;text-transform:uppercase;letter-spacing:1px;text-align:center}
    .earning-item{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:rgba(255,255,255,.03);border-radius:8px;margin-bottom:8px;border:1px solid rgba(255,255,255,.05)}
    .earning-label{font-size:.9em;font-weight:500;color:#e0e0e0}
    .earning-value{font-size:.9em;font-weight:600}
    .balance-value{color:#4ade80}.total-earning-value{color:#f59e0b}.today-earning-value{color:#3b82f6}

    /* Ads section */
    .ads-section{position:relative;padding:16px;border-radius:16px;background:rgba(255,255,255,.06);backdrop-filter:blur(14px) saturate(120%);border:1px solid rgba(255,255,255,.14);box-shadow:0 10px 30px rgba(0,0,0,.35),inset 0 1px 0 rgba(255,255,255,.06);margin-bottom:16px}
    .section-title{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:999px;background:linear-gradient(135deg,#67e8f9,#a78bfa,#f472b6);color:#0b1020;font-weight:700;font-size:.9em;margin:0 auto 14px;box-shadow:0 6px 18px rgba(167,139,250,.35)}

    .ad-item{display:flex;flex-direction:column;gap:10px;padding:14px;border-radius:14px;background:rgba(13,18,35,.55);border:1px solid rgba(255,255,255,.08);box-shadow:0 8px 20px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);margin-bottom:12px}
    .ad-title{font-size:1.02em;font-weight:700;letter-spacing:.2px;color:#f4f4f5}
    .ad-reward{display:inline-flex;align-items:center;gap:8px;width:max-content;padding:6px 10px;border-radius:10px;background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(34,197,94,.15));color:#34d399;font-weight:600;border:1px solid rgba(16,185,129,.35)}

    .progress-row{display:flex;flex-direction:column;gap:6px;margin-top:6px}
    .progress-label{display:flex;justify-content:space-between;align-items:center;font-size:.85em;color:#cfd6e6}
    .progress-track{position:relative;height:10px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);overflow:hidden}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#22c55e 0%,#10b981 45%,#06b6d4 100%);transition:width .35s ease}

    .ad-btn{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);font-weight:700;cursor:pointer}
    .ad-btn:disabled{opacity:.6;cursor:not-allowed}
    .watch-btn{background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:#fff;box-shadow:0 8px 20px rgba(124,58,237,.4)}
    .ad-processing-btn{background:linear-gradient(135deg,#60a5fa,#3b82f6);color:#fff;cursor:wait;position:relative;box-shadow:0 6px 16px rgba(59,130,246,.35)}
    .ad-processing-btn::after{content:"";width:16px;height:16px;margin-left:8px;display:inline-block;border-radius:50%;border:2px solid rgba(255,255,255,.7);border-top-color:transparent;animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Bottom nav (Home-style) */
    .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:340px;background:rgba(0,0,0,.9);backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,.1);border-radius:20px 20px 0 0;padding:16px 12px;display:flex;justify-content:space-around;align-items:center;z-index:100}
    .nav-item{display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:8px 8px;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);min-width:50px;flex:1;margin:0 2px;transition:transform .2s ease, background .2s ease}
    .nav-item:hover{background:rgba(255,255,255,.1);transform:translateY(-2px)}
    .nav-item.active{background:rgba(102,126,234,.2);border-color:rgba(102,126,234,.3)}
    .nav-icon{width:22px;height:22px;margin-bottom:4px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}
    .nav-home .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'/%3E%3C/svg%3E")}
    .nav-invite .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7M16 6l-4-4-4 4M12 2v14' stroke='currentColor' stroke-width='2' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E")}
    .nav-task .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E")}
    .nav-ads .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z'/%3E%3C/svg%3E")}
    .nav-wallet .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z'/%3E%3C/svg%3E")}
    .nav-label{font-size:.7em;font-weight:500;color:#e0e0e0;text-transform:uppercase;letter-spacing:.3px}

    @media(max-width:360px){
      .container{width:100%;padding:7px 3px 90px 3px}
      .bottom-nav{width:100%}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Earnings Summary -->
    <div class="earnings-box">
      <div class="earnings-title">üìä Earnings Summary</div>
      <div class="earning-item"><div class="earning-label">üí∞ Balance:</div><div class="earning-value balance-value" id="balance-display">... BUMS</div></div>
      <div class="earning-item"><div class="earning-label">üìà Total Earning:</div><div class="earning-value total-earning-value" id="total-earning">... BUMS</div></div>
      <div class="earning-item"><div class="earning-label">‚≠ê Today Earning:</div><div class="earning-value today-earning-value" id="today-earning">... BUMS</div></div>
    </div>

    <!-- Ads -->
    <div class="ads-section">
      <div class="section-title">üé¨ Watch Ads & Earn</div>

      <!-- Premium -->
      <div class="ad-item">
        <div class="ad-title">üíé Premium Video Ad</div>
        <div class="ad-reward">+ 4 BUMS per ad</div>
        <div class="progress-row">
          <div class="progress-label"><span>View progress</span><span id="premium-view-text">0/25</span></div>
          <div class="progress-track"><div class="progress-fill" id="premium-view-bar"></div></div>
        </div>
        <button class="ad-btn watch-btn" id="ad-button-premium">Watch Ad</button>
      </div>

      <!-- Sponsored -->
      <div class="ad-item">
        <div class="ad-title">üöÄ Sponsored Content</div>
        <div class="ad-reward">+ 4 BUMS per view</div>
        <div class="progress-row">
          <div class="progress-label"><span>View progress</span><span id="sponsored-view-text">0/25</span></div>
          <div class="progress-track"><div class="progress-fill" id="sponsored-view-bar"></div></div>
        </div>
        <button class="ad-btn watch-btn" id="ad-button-sponsored">Watch Ad</button>
      </div>
    </div>
  </div>

  <!-- Snackbar -->
  <div id="snackbar" style="display:none;position:fixed;top:18px;left:50%;transform:translateX(-50%);background:#059669;color:#fff;padding:12px 24px;border-radius:24px;z-index:2001;font-weight:600;box-shadow:0 4px 16px rgba(5,150,105,.4)"></div>

  <!-- Bottom nav -->
  <div class="bottom-nav">
    <div class="nav-item nav-home" onclick="window.location.href='index.html'">
      <div class="nav-icon"></div><span class="nav-label">Home</span>
    </div>
    <div class="nav-item nav-invite" onclick="window.location.href='invite.html'">
      <div class="nav-icon"></div><span class="nav-label">Invite</span>
    </div>
    <div class="nav-item nav-task" onclick="window.location.href='tasks.html'">
      <div class="nav-icon"></div><span class="nav-label">Tasks</span>
    </div>
    <div class="nav-item nav-ads active" onclick="window.location.href='ads.html'">
      <div class="nav-icon"></div><span class="nav-label">Ads</span>
    </div>
    <div class="nav-item nav-wallet" onclick="window.location.href='wallet.html'">
      <div class="nav-icon"></div><span class="nav-label">Wallet</span>
    </div>
  </div>

  <!-- Monetag SDKs: two separate zones -->
  <script src='//libtl.com/sdk.js' data-zone='9903518'  data-sdk='show_9903518'></script>
  <script src='//libtl.com/sdk.js' data-zone='10005741' data-sdk='show_10005741'></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, get, set, onValue, runTransaction, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const snack=(m,bad=false)=>{ const el=document.getElementById('snackbar'); el.textContent=m; el.style.background=bad?'#ef4444':'#059669'; el.style.display='block'; setTimeout(()=>el.style.display='none', bad?3500:1600); try{window.Telegram?.WebApp?.HapticFeedback?.notificationOccurred?.(bad?'error':'success');}catch{} };

    const firebaseConfig={ apiKey:"AIzaSyALUr9fR5GE5CxPwY2xdYcIEvy33nu4vbs", authDomain:"money-bums-c9eba.firebaseapp.com", databaseURL:"https://money-bums-c9eba-default-rtdb.firebaseio.com", projectId:"money-bums-c9eba", storageBucket:"money-bums-c9eba.firebasestorage.app", messagingSenderId:"759031341495", appId:"1:759031341495:web:e9d2f9a7ec124e0a524832", measurementId:"G-XWHHSQHPP9" };
    const app=initializeApp(firebaseConfig);
    const db=getDatabase(app);

    window.Telegram?.WebApp?.ready?.();
    const UID=String(window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "NOT_APP");

    async function ensureUser(){
      const uref=ref(db,`users/${UID}`); const s=await get(uref);
      if(!s.exists()){ await set(uref,{balance:0,earnings_total:0,createdAt:Date.now()}); }
      else{ const v=s.val()||{}; const patch={}; if(v.balance===undefined) patch.balance=0; if(v.earnings_total===undefined) patch.earnings_total=0; if(Object.keys(patch).length) await update(uref,patch); }
    }
    await ensureUser();

    const TKEY=(()=>{ const d=new Date(); const y=d.getUTCFullYear(), m=String(d.getUTCMonth()+1).padStart(2,'0'), da=String(d.getUTCDate()).padStart(2,'0'); return `${y}${m}${da}`; })();
    const balEl=document.getElementById('balance-display');
    const totEl=document.getElementById('total-earning');
    const todayEl=document.getElementById('today-earning');

    onValue(ref(db,`users/${UID}/balance`), s=> balEl.textContent=`${Number(s.val()||0)} BUMS`);             /* [web:73] */
    onValue(ref(db,`users/${UID}/earnings_total`), s=> totEl.textContent=`${Number(s.val()||0)} BUMS`);      /* [web:73] */
    onValue(ref(db,`users/${UID}/earnings_daily/${TKEY}/amount`), s=> todayEl.textContent=`${Number(s.val()||0)} BUMS`); /* [web:73] */

    const CAP=25, REWARD=4;
    const pvText=document.getElementById('premium-view-text'),   pvBar=document.getElementById('premium-view-bar');
    const spText=document.getElementById('sponsored-view-text'), spBar=document.getElementById('sponsored-view-bar');
    const paint=(c,txt,bar)=>{ const v=Number(c||0); txt.textContent=`${v}/${CAP}`; bar.style.width=`${Math.min(100,Math.round((v/CAP)*100))}%`; };

    onValue(ref(db,`users/${UID}/ad_counts/video/${TKEY}/count`),     s=>{ const c=Number(s.val()||0); paint(c,pvText,pvBar); document.getElementById('ad-button-premium').disabled=c>=CAP; });  /* [web:73] */
    onValue(ref(db,`users/${UID}/ad_counts/sponsored/${TKEY}/count`), s=>{ const c=Number(s.val()||0); paint(c,spText,spBar); document.getElementById('ad-button-sponsored').disabled=c>=CAP; }); /* [web:73] */

    async function credit(typeKey){
      const cRef=ref(db,`users/${UID}/ad_counts/${typeKey}/${TKEY}/count`);
      const t1=await runTransaction(cRef,cur=>{ const c=Number(cur||0); if(c>=CAP) return; return c+1; }); /* [web:77] */
      if(!t1.committed){ snack('Daily limit reached',true); return; }

      await runTransaction(ref(db,`users/${UID}/balance`),cur=>Number(cur||0)+REWARD);                         /* [web:77] */
      await runTransaction(ref(db,`users/${UID}/earnings_daily/${TKEY}/amount`),cur=>Number(cur||0)+REWARD);   /* [web:77] */
      await runTransaction(ref(db,`users/${UID}/earnings_total`),cur=>Number(cur||0)+REWARD);                  /* [web:77] */

      snack(`+${REWARD} BUMS added`);
    }

    // Cooldown: 4 seconds after reward
    async function cooldown(btn, seconds=4){
      let t=seconds; const origClass=btn.className;
      btn.disabled=true;
      const tick=()=>{ btn.className='ad-btn ad-processing-btn'; btn.textContent=`Wait ${t}s`; };
      tick();
      while(t>0){ await new Promise(r=>setTimeout(r,1000)); t--; if(t>0) tick(); }
      btn.className='ad-btn watch-btn'; btn.textContent='Watch Ad'; btn.disabled=false;
    }

    // Bind with Monetag + cooldown
    function bindWithCooldown(btnId,typeKey,funcName){
      const btn=document.getElementById(btnId);
      btn.addEventListener('click', async ()=>{
        if(btn.disabled) return;
        btn.disabled=true; btn.className='ad-btn ad-processing-btn'; btn.textContent='Loading Ad...';
        const play=(typeof window[funcName]==='function') ? window[funcName] : ()=> new Promise(r=>setTimeout(r,1200));
        try{
          await play({ ymid:String(UID), requestVar:typeKey });       /* Monetag Promise */  /* [web:187][web:186] */
          await credit(typeKey);                                      /* Firebase credit */  /* [web:77] */
          await cooldown(btn,4);                                      /* 4s lock */
        }catch(e){
          btn.className='ad-btn watch-btn'; btn.textContent='Watch Ad'; btn.disabled=false;
          snack('Ad failed',true);
        }
      });
    }

    bindWithCooldown('ad-button-premium','video','show_9903518');
    bindWithCooldown('ad-button-sponsored','sponsored','show_10005741');
  </script>
</body>
</html>
