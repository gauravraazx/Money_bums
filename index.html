<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Home - BUMS</title>
  <meta name="viewport" content="width=340, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:linear-gradient(135deg,#0b1224 0%,#0f1e3a 50%,#081224 100%);
      color:#fff;font-family:'Inter',Arial,sans-serif;min-height:100vh;overflow-x:hidden;font-size:13px
    }
    .container{width:340px;margin:0 auto;padding:12px 8px 100px 8px}

    /* Heading (Sticky) */
    .heading{position:sticky;top:0;z-index:50;display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:0 0 16px 16px;padding:14px 14px;backdrop-filter:blur(14px);box-shadow:0 4px 18px rgba(0,0,0,.35)}
    .bal-wrap{display:flex;flex-direction:column}
    .bal-label{font-size:.8em;color:#cfe0ff;letter-spacing:.4px}
    .bal-value{font-size:1.2em;font-weight:800}
    .task-btn{border:none;border-radius:12px;padding:10px 14px;background:linear-gradient(135deg,#60a5fa,#3b82f6);color:#fff;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:8px;box-shadow:0 8px 24px rgba(59,130,246,.35)}
    .task-btn::before{content:"+";display:inline-block;width:16px;height:16px;font-weight:900}

    /* Mini games header (small like Daily) */
    .mg{margin-top:14px}
    .mg-title{font-weight:800;font-size:18px;margin-bottom:4px}
    .mg-sub{color:#bfc7da;margin-bottom:12px}

    /* Quick actions list */
    .section{margin-top:0}
    .qa-item{display:flex;align-items:center;justify-content:space-between;padding:14px;border-radius:14px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);box-shadow:0 8px 22px rgba(0,0,0,.35);margin-bottom:10px;cursor:pointer;transition:transform .15s ease, background .2s ease}
    .qa-item:hover{transform:translateY(-2px);background:rgba(255,255,255,.08)}
    .qa-left{display:flex;align-items:center;gap:12px}
    .qa-icon{width:26px;height:26px;border-radius:8px;background:linear-gradient(135deg,#22c55e,#06b6d4);display:flex;align-items:center;justify-content:center}
    .qa-icon.tickets{background:linear-gradient(135deg,#f59e0b,#ef4444)}
    .qa-icon.treasure{background:linear-gradient(135deg,#a78bfa,#f472b6)}
    .qa-title{font-weight:800;letter-spacing:.2px}
    .qa-sub{font-size:.85em;color:#cfd6e6}

    /* Daily tasks */
    .daily-wrap{margin-top:14px}
    .daily-title{font-weight:800;font-size:18px;margin-bottom:4px}
    .daily-sub{color:#bfc7da;margin-bottom:12px}
    .task-card{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:14px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);box-shadow:0 8px 22px rgba(0,0,0,.35);margin-bottom:10px}
    .task-left{display:flex;align-items:center;gap:12px}
    .task-ico{width:32px;height:32px;border-radius:10px;background:rgba(255,255,255,.08);position:relative}
    .task-ico.cal::before{content:"";position:absolute;inset:0;margin:auto;width:20px;height:20px;background:#fff;mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10h5v5H7z M3 8h18v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z M7 2v4 M17 2v4" stroke="%23000" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>') center/contain no-repeat}
    .task-ico.share::before{content:"";position:absolute;inset:0;margin:auto;width:20px;height:20px;background:#fff;mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 12v7a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-7M16 6l-4-4-4 4M12 2v14" stroke="%23000" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>') center/contain no-repeat}
    .task-ico.refresh::before{content:"";position:absolute;inset:0;margin:auto;width:20px;height:20px;background:#fff;mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 1 1 2.13 8.36" stroke="%23000" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>') center/contain no-repeat}
    .task-text{display:flex;flex-direction:column}
    .task-name{font-weight:700;letter-spacing:.2px}
    .task-rew{margin-top:2px}
    .coin{display:inline-block;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:4px 8px;border-radius:10px;font-weight:700;color:#ffd479}
    .task-btn-mini{border:none;border-radius:10px;padding:8px 12px;background:rgba(255,255,255,.08);color:#fff;font-weight:700;cursor:pointer;border:1px solid rgba(255,255,255,.15)}
    .task-btn-mini.done{opacity:.6;cursor:not-allowed}

    /* Toast */
    .toast{
      position:fixed;top:10px;left:50%;transform:translateX(-50%) translateY(-20px);
      background:rgba(34,197,94,.95);color:#071b0f;border:1px solid rgba(34,197,94,.6);
      padding:10px 14px;border-radius:14px;font-weight:800;letter-spacing:.3px;
      box-shadow:0 10px 28px rgba(0,0,0,.35);opacity:0;z-index:120;transition:all .25s ease
    }
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

    /* Bottom nav - NEW DESIGN FROM ADS.HTML */
    .bottom-nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:340px;background:rgba(0,0,0,.9);backdrop-filter:blur(20px);border-top:1px solid rgba(255,255,255,.1);border-radius:20px 20px 0 0;padding:16px 12px;display:flex;justify-content:space-around;align-items:center;z-index:100}
    .nav-item{display:flex;flex-direction:column;align-items:center;cursor:pointer;padding:8px 8px;border-radius:12px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);min-width:50px;flex:1;margin:0 2px;transition:transform .2s ease, background .2s ease}
    .nav-item:hover{background:rgba(255,255,255,.1);transform:translateY(-2px)}
    .nav-item.active{background:rgba(102,126,234,.2);border-color:rgba(102,126,234,.3)}
    .nav-icon{width:22px;height:22px;margin-bottom:4px;background:#fff;mask-size:contain;mask-repeat:no-repeat;mask-position:center}
    .nav-home .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'/%3E%3C/svg%3E")}
    .nav-ads .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z'/%3E%3C/svg%3E")}
    .nav-task .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E")}
    .nav-wallet .nav-icon{mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z'/%3E%3C/svg%3E")}
    .nav-label{font-size:.7em;font-weight:500;color:#e0e0e0;text-transform:uppercase;letter-spacing:.3px}

    /* Snackbar */
    #snackbar{display:none;position:fixed;top:18px;left:50%;transform:translateX(-50%);background:#059669;color:white;padding:12px 24px;border-radius:24px;z-index:2001;font-weight:600;font-size:1em;box-shadow:0 4px 16px rgba(5,150,105,.4);transition:opacity .4s;opacity:1;letter-spacing:.5px}
    #snackbar.error{background:#ef4444;box-shadow:0 4px 16px rgba(239,68,68,.4)}

    @media(max-width:360px){.container{width:100%;padding:7px 3px 90px 3px}.bottom-nav{width:100%}.ad-item{padding:12px}.ad-btn{padding:11px 12px}}
  </style>
</head>
<body>
  <div class="container">

    <!-- Heading -->
    <div class="heading">
      <div class="bal-wrap">
        <div class="bal-label">Balance (BUMS)</div>
        <div class="bal-value" id="balBums">0</div>
      </div>
      <button class="task-btn" onclick="location.href='create.html'">TASK</button>
    </div>

    <!-- Mini games header (small) -->
    <div class="mg">
      <div class="mg-title">Mini games</div>
      <div class="mg-sub">Play our games and win rewards.</div>
    </div>

    <!-- Quick actions -->
    <div class="section">
      <div class="qa-item" onclick="location.href='spin.html'">
        <div class="qa-left">
          <div class="qa-icon">üéØ</div>
          <div>
            <div class="qa-title">SPIN AND WIN</div>
            <div class="qa-sub">Try luck and win BUMS</div>
          </div>
        </div>
        <div>‚Ä∫</div>
      </div>

      <div class="qa-item" onclick="location.href='tickets.html'">
        <div class="qa-left">
          <div class="qa-icon tickets">üéüÔ∏è</div>
          <div>
            <div class="qa-title">Tickets</div>
            <div class="qa-sub">Enter draws and events</div>
          </div>
        </div>
        <div>‚Ä∫</div>
      </div>

      <div class="qa-item" onclick="location.href='treasure.html'">
        <div class="qa-left">
          <div class="qa-icon treasure">üóùÔ∏è</div>
          <div>
            <div class="qa-title">Treasure</div>
            <div class="qa-sub">Hidden chests with rewards</div>
          </div>
        </div>
        <div>‚Ä∫</div>
      </div>
    </div>

    <!-- Daily tasks -->
    <div class="daily-wrap">
      <div class="daily-title">Daily tasks</div>
      <div class="daily-sub">Complete daily tasks and get rewards.</div>

      <div class="task-card" id="t-check">
        <div class="task-left">
          <div class="task-ico cal"></div>
          <div class="task-text">
            <div class="task-name">Just check in</div>
            <div class="task-rew"><span class="coin">+ 10 BUMS</span></div>
          </div>
        </div>
        <button class="task-btn-mini" data-key="checkin">Mark</button>
      </div>

      <div class="task-card" id="t-share">
        <div class="task-left">
          <div class="task-ico share"></div>
          <div class="task-text">
            <div class="task-name">Share with friends</div>
            <div class="task-rew"><span class="coin">+ 15 BUMS</span></div>
          </div>
        </div>
        <button class="task-btn-mini" data-key="share">Share</button>
      </div>

      <div class="task-card" id="t-update">
        <div class="task-left">
          <div class="task-ico refresh"></div>
          <div class="task-text">
            <div class="task-name">Check for updates</div>
            <div class="task-rew"><span class="coin">+ 15 BUMS</span></div>
          </div>
        </div>
        <button class="task-btn-mini" data-key="update">Check</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Bottom nav - NEW FROM ADS.HTML -->
  <div class="bottom-nav">
    <div class="nav-item nav-home active" onclick="window.location.href='index.html'"><div class="nav-icon"></div><span class="nav-label">Home</span></div>
    <div class="nav-item nav-task" onclick="window.location.href='tasks.html'"><div class="nav-icon"></div><span class="nav-label">Tasks</span></div>
    <div class="nav-item nav-ads" onclick="window.location.href='ads.html'"><div class="nav-icon"></div><span class="nav-label">Ads</span></div>
    <div class="nav-item nav-wallet" onclick="window.location.href='wallet.html'"><div class="nav-icon"></div><span class="nav-label">Wallet</span></div>
  </div>

  <!-- Telegram SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, get, set, update, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyALUr9fR5GE5CxPwY2xdYcIEvy33nu4vbs",
      authDomain: "money-bums-c9eba.firebaseapp.com",
      databaseURL: "https://money-bums-c9eba-default-rtdb.firebaseio.com",
      projectId: "money-bums-c9eba",
      storageBucket: "money-bums-c9eba.firebasestorage.app",
      messagingSenderId: "759031341495",
      appId: "1:759031341495:web:e9d2f9a7ec124e0a524832",
      measurementId: "G-XWHHSQHPP9"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    const balEl = document.getElementById('balBums');

    // Toast + haptics
    function toast(msg){
      const el = document.getElementById('toast');
      if (!el) return;
      el.textContent = msg;
      el.classList.add('show');
      try{ window.Telegram?.WebApp?.HapticFeedback?.notificationOccurred?.('success'); }catch{}
      setTimeout(()=> el.classList.remove('show'), 1600);
    }

    // Telegram user
    function getTelegramUser() {
      try { const tg = window.Telegram?.WebApp; tg?.ready?.(); const u = tg?.initDataUnsafe?.user; if (u?.id) return u; } catch {}
      try {
        const parse = (src) => { const sp=new URLSearchParams(src); const raw=sp.get('tgWebAppData')||sp.get('tgwebappdata'); if(!raw) return null; const inner=new URLSearchParams(raw); const s=inner.get('user'); return s?JSON.parse(s):null; };
        const h = location.hash? parse(location.hash.slice(1)) : null; if (h?.id) return h;
        const q = parse(location.search.slice(1)); if (q?.id) return q;
      } catch {}
      return { id: "NOT_APP" };
    }

    async function ensureBalance(uid){
      const uref = ref(db, `users/${uid}`);
      const snap = await get(uref);
      if (!snap.exists()){ await set(uref, { balance: 0, createdAt: Date.now() }); return 0; }
      const val = snap.val() || {};
      if (val.balance === undefined){ await update(uref, { balance: 0 }); return 0; }
      return Number(val.balance || 0);
    }
    function listenBalance(uid){
      onValue(ref(db, `users/${uid}/balance`), s=>{
        const b = Number(s.val() || 0);
        if (balEl) balEl.textContent = b.toString();
      });
    }

    const todayKey = () => new Date().toISOString().slice(0,10);
    async function ensureDaily(uid){
      const path = `users/${uid}/daily/${todayKey()}`;
      await runTransaction(ref(db, path), (val)=> val || { checkin:false, share:false, update:false, claimed:{checkin:false,share:false,update:false} });
    }
    async function addBalance(uid, amt){
      await runTransaction(ref(db, `users/${uid}/balance`), v => Number(v||0) + amt);
    }
    function setDone(btn){ btn.classList.add('done'); btn.textContent = "Done"; btn.disabled = true; }

    const REWARDS = { checkin:10, share:15, update:15 };

    function openChannel(){ window.location.href = "https://t.me/moneybums_channel"; }
    function shareMsg(uid){
      const text = encodeURIComponent(`üéÅ Earn free TON üòâ\n\nhttps://t.me/moneybums_bot?start=${uid}\n\n‚úÖ COMPLETE SIMPLE TASK AND EARN TON \n‚úÖ INVITE YOUR FRIENDS AND EARN TON`);
      window.location.href = `https://t.me/share/url?url=${encodeURIComponent('https://t.me/moneybums_bot')}&text=${text}`;
    }

    async function wireDaily(uid){
      await ensureDaily(uid);

      onValue(ref(db, `users/${uid}/daily/${todayKey()}/claimed`), snap=>{
        const c = snap.val() || {};
        const map = { checkin:'t-check', share:'t-share', update:'t-update' };
        Object.entries(map).forEach(([k, id])=>{
          const btn = document.querySelector(`#${id} .task-btn-mini`);
          if (!btn) return;
          if (c[k]) setDone(btn);
        });
      });

      document.querySelectorAll('.task-btn-mini').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          if (btn.classList.contains('done')) return;
          const key = btn.dataset.key;
          const base = `users/${uid}/daily/${todayKey()}`;

          if (key === 'update'){ openChannel(); }
          if (key === 'share'){ shareMsg(uid); }

          const tx = await runTransaction(ref(db, `${base}/claimed/${key}`), v => v ? v : true);
          if (tx.committed && tx.snapshot.val() === true){
            const amt = REWARDS[key] || 0;
            await addBalance(uid, amt);
            setDone(btn);
            const nice = key==='checkin'?'Just check in':(key==='share'?'Share with friends':'Check for updates');
            toast(`Task completed: ${nice} +${amt} BUMS`);
          }
        });
      });
    }

    async function boot(){
      const u = getTelegramUser();
      const uid = String(u?.id || "NOT_APP");
      const b = await ensureBalance(uid);
      if (balEl) balEl.textContent = String(b);
      listenBalance(uid);
      wireDaily(uid);
    }

    boot();
  </script>
</body>
</html>